---
import loginSave from "@utils/login";
let token = "none";
let redir = "/login";
let maxAge = "none";
if (Astro.request.method === "POST") {
  const data = Object.fromEntries(new URLSearchParams(await Astro.request.text()));
  const d = await loginSave(data.email, data.password);
  if (d.success == true) {
    token = d?.token;
    redir = "/";
    maxAge = d?.max;
  }
} else {
  return Astro.redirect("/login");
}
---

<script
  define:vars={{
    token,
    redir,
    maxAge,
  }}
>
  if (token !== "none") {
    document.cookie = `login=${token}; Max-Age=${maxAge}; path=/`;
    window.location.href = redir;
  }
</script>
